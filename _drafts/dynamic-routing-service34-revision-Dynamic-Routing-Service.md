---
id: 159
title: Dynamic Routing Service
date: 2007-10-29T12:52:08+00:00
author: remus
layout: revision
guid: http://rusanu.com/2007/10/29/34-revision/
permalink: /2007/10/29/34-revision/
---
<p __designer:dtid="281474976710660">So how does one deploy Service Broker services in a large enterprise? Hundreds of services that change location every now and then (just enough to create a major outage exactly at the wrong moment!), and each database requiring a route to any service it wishes to interact with. Creating hundreds and thousands of routes and maintaining them as each new service is deployed, is retired or is moved is a difficult task and obviously prone to operational mistakes, pretty much a disaster waiting to happen.<!--more--></p> <p __designer:dtid="281474976710661">One solution to this problem is to use a ‘dynamic routing service’, as described in the Service Broker routing algorithm <a href="http://technet.microsoft.com/en-us/library/ms166052.aspx" __designer:dtid="281474976710662">http://technet.microsoft.com/en-us/library/ms166052.aspx</a>:</p> <p __designer:dtid="281474976710663">4. If a route to a dynamic routing service is present, and no request for a route to the service is pending, mark the conversation delayed and request routing information from that service.</p> <p __designer:dtid="281474976710664">What is a ‘dynamic routing service’? Is just an ordinary Service Broker service, implemented by your enterprise/environment and responsible to provide routing information for all the services in the environment is deployed in. Whenever the Service Broker needs to route message to a service with an unknown location it will request the ‘dynamic routing service’ to find the location of the unknown service and provide the appropriate routing information. The request for routing information is, obviously, a Service Broker message delivered to the ‘dynamic routing service’ queue. The ‘dynamic routing service’ is expected to actually create a route in the database and then ‘respond’ to the request by ending the dialog.</p> <h2 __designer:dtid="281474976710665">Example</h2> <p __designer:dtid="281474976710666">Let’s see how the ‘dynamic routing’ behaves in practice. So we’ll create a ‘dynamic routing service’ and watch it in action. For this example we’ll consider that a newly deployed ‘MyDepartament/MyService’ application/service needs to exchange messages with the ‘MyEnterprise/Accounting’ service. So go ahead and create this ‘application’:</p> 

<code __designer:dtid="281474976710667"></code><p __designer:dtid="281474976710668" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710669" style="font-size: 10pt; color: blue; font-family: 'Courier New'">create</span><span __designer:dtid="281474976710670" style="font-size: 10pt; font-family: 'Courier New'"> <span __designer:dtid="281474976710671" style="color: blue">queue</span> [MyDepartament/MyService/Queue]<span __designer:dtid="281474976710672" style="color: gray">;

<!--l                      namespace="" ns="urn:schemas-microsoft-com:office:office" prefix="o"--></span></span></p> <p __designer:dtid="281474976710674" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710675" style="font-size: 10pt; color: blue; font-family: 'Courier New'">create</span><span __designer:dtid="281474976710676" style="font-size: 10pt; font-family: 'Courier New'"> <span __designer:dtid="281474976710677" style="color: blue">service</span> [MyDepartament/MyService]</span></p> <p __designer:dtid="281474976710679" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal">&nbsp;</p> 

<span __designer:dtid="281474976710680" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976710681"> </span><span __designer:dtid="281474976710682" style="color: blue">on</span> <span __designer:dtid="281474976710683" style="color: blue">queue</span> [MyDepartament/MyService/Queue]<span __designer:dtid="281474976710684" style="color: gray">;</span></span><p _\_designer:dtid="281474976710686">When this application initiates a dialog with the ‘MyEnterprise/Accounting’ service, messages will just sit in sys.transmission\_queue because Service Broker needs to know the location of this service, it needs a route. Let’s have the ‘application’ send a message (for simplicity will use the implicit [DEFAULT] contract and message type):</p> 

<code __designer:dtid="281474976710687"></code><p __designer:dtid="281474976710688" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710689" style="font-size: 10pt; color: blue; font-family: 'Courier New'">begin</span><span __designer:dtid="281474976710690" style="font-size: 10pt; font-family: 'Courier New'"> <span __designer:dtid="281474976710691" style="color: blue">transaction</span><span __designer:dtid="281474976710692" style="color: gray">;

<!--l namespace=""                      ns="urn:schemas-microsoft-com:office:office" prefix="o"--></span></span></p> <p __designer:dtid="281474976710694" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710695" style="font-size: 10pt; color: blue; font-family: 'Courier New'">declare</span><span __designer:dtid="281474976710696" style="font-size: 10pt; font-family: 'Courier New'"> @h <span __designer:dtid="281474976710697" style="color: blue">uniqueidentifier</span><span __designer:dtid="281474976710698" style="color: gray">;</span></span></p> <p __designer:dtid="281474976710700" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710701" style="font-size: 10pt; color: blue; font-family: 'Courier New'">begin</span><span __designer:dtid="281474976710702" style="font-size: 10pt; font-family: 'Courier New'"> <span __designer:dtid="281474976710703" style="color: blue">dialog</span> <span __designer:dtid="281474976710704" style="color: blue">conversation</span> @h</span></p> <p __designer:dtid="281474976710706" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710707" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976710708"> </span><span __designer:dtid="281474976710709" style="color: blue">from</span> <span __designer:dtid="281474976710710" style="color: blue">service</span> [MyDepartament/MyService]</span></p> <p __designer:dtid="281474976710712" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710713" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976710714"> </span><span __designer:dtid="281474976710715" style="color: blue">to</span> <span __designer:dtid="281474976710716" style="color: blue">service</span> N<span __designer:dtid="281474976710717" style="color: red">&#8216;MyEnterprise/Accounting&#8217;</span></span></p> <p __designer:dtid="281474976710719" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710720" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976710721"> </span><span __designer:dtid="281474976710722" style="color: blue">with</span> <span __designer:dtid="281474976710723" style="color: blue">encryption</span> <span __designer:dtid="281474976710724" style="color: gray">=</span> <span __designer:dtid="281474976710725" style="color: blue">off</span><span __designer:dtid="281474976710726" style="color: gray">;</span></span></p> <p __designer:dtid="281474976710728" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710729" style="font-size: 10pt; color: blue; font-family: 'Courier New'">send</span><span __designer:dtid="281474976710730" style="font-size: 10pt; font-family: 'Courier New'"> <span __designer:dtid="281474976710731" style="color: blue">on</span> <span __designer:dtid="281474976710732" style="color: blue">conversation</span> @h <span __designer:dtid="281474976710733" style="color: gray">(</span>N<span __designer:dtid="281474976710734" style="color: red">&#8216;<request account=&#8221;FOO&#8221; information=&#8221;credit limit&#8221;></request>&#8217;</span><span __designer:dtid="281474976710735" style="color: gray">);</span></span></p> <p __designer:dtid="281474976710737" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710738" style="font-size: 10pt; color: blue; font-family: 'Courier New'">commit</span><span __designer:dtid="281474976710739" style="font-size: 10pt; color: gray; font-family: 'Courier New'">;</span></p> <p __designer:dtid="281474976710741" style="margin: 0in 0in 10pt" class="MsoNormal">&nbsp;</p> 

<span __designer:dtid="281474976710742" style="font-size: 10pt; line-height: 115%; font-family: 'Courier New'">go</span><p _\_designer:dtid="281474976710743">If we check the sys.transmission\_queue, we found the message there delayed because there is no routing information about the location of the service:</p> 

<code __designer:dtid="281474976710744"></code><p __designer:dtid="281474976710745" style="margin: 0in 0in 10pt" class="MsoNormal"><span __designer:dtid="281474976710746" style="font-size: 10pt; color: blue; line-height: 115%; font-family: 'Courier New'">select</span><span _\_designer:dtid="281474976710747" style="font-size: 10pt; line-height: 115%; font-family: 'Courier New'"> transmission\_status <span __designer:dtid="281474976710748" style="color: blue">from</span> <span _\_designer:dtid="281474976710749" style="color: green">sys.transmission\_queue</span><span __designer:dtid="281474976710750" style="color: gray">;</span></span><span __designer:dtid="281474976710751" style="font-family: 'Verdana','sans-serif'">

<!--l namespace="" ns="urn:schemas-microsoft-com:office:office"                              prefix="o"--></span></p> <p __designer:dtid="281474976710753" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span _\_designer:dtid="281474976710754" style="font-size: 8pt; font-family: 'Courier New'">transmission\_status</span></p> <p __designer:dtid="281474976710756" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710757" style="font-size: 8pt; font-family: 'Courier New'">&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</span></p> <p __designer:dtid="281474976710758" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710759" style="font-size: 8pt; font-family: 'Courier New'">The target service name could not be found. Ensure that the service name is specified correctly and/or the routing information has been supplied.</span></p> <p __designer:dtid="281474976710761" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710762" style="font-size: 8pt; font-family: 'Courier New'"> </span></p> <p __designer:dtid="281474976710764" style="margin: 0in 0in 10pt" class="MsoNormal">&nbsp;</p> 

<span __designer:dtid="281474976710765" style="font-size: 8pt; line-height: 115%; font-family: 'Courier New'">(1 row(s) affected)</span><p __designer:dtid="281474976710766">Let’s see how things change if we introduce a ‘dynamic routing service’. Note that the service name must be SQL/ServiceBroker/BrokerConfiguration:</p> 

<code __designer:dtid="281474976710767"></code><p __designer:dtid="281474976710768" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710769" style="font-size: 10pt; color: blue; font-family: 'Courier New'">create</span><span __designer:dtid="281474976710770" style="font-size: 10pt; font-family: 'Courier New'"> <span __designer:dtid="281474976710771" style="color: blue">queue</span> [SQL/ServiceBroker/BrokerConfiguration/Queue]<span __designer:dtid="281474976710772" style="color: gray">;

<!--l namespace="" ns="urn:schemas-microsoft-com:office:office"                          prefix="o"--></span></span></p> <p __designer:dtid="281474976710774" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710775" style="font-size: 10pt; color: blue; font-family: 'Courier New'">create</span><span __designer:dtid="281474976710776" style="font-size: 10pt; font-family: 'Courier New'"> <span __designer:dtid="281474976710777" style="color: blue">service</span> [SQL/ServiceBroker/BrokerConfiguration]</span></p> <p __designer:dtid="281474976710779" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710780" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976710781"> </span><span __designer:dtid="281474976710782" style="color: blue">on</span> <span __designer:dtid="281474976710783" style="color: blue">queue</span> [SQL/ServiceBroker/BrokerConfiguration/Queue]</span></p> <p __designer:dtid="281474976710785" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710786" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976710787"> </span><span __designer:dtid="281474976710788" style="color: gray">(</span>[http://schemas.microsoft.com/SQL/ServiceBroker/BrokerConfigurationNotice]<span __designer:dtid="281474976710789" style="color: gray">);</span></span></p> <p __designer:dtid="281474976710791" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal">&nbsp;</p> 

<span __designer:dtid="281474976710792" style="font-size: 10pt; font-family: 'Courier New'">go</span><p __designer:dtid="281474976710794">This doesn’t change anything so far, because the routing algorithm described at http://technet.microsoft.com/en-us/library/ms166052.aspx says that a route to this service has to exist in order that ‘dynamic routing’ functionality is used. So let’s go ahead and create this route:</p> 

<code __designer:dtid="281474976710795"></code><p __designer:dtid="281474976710796" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710797" style="font-size: 10pt; color: blue; font-family: 'Courier New'">create</span><span __designer:dtid="281474976710798" style="font-size: 10pt; font-family: 'Courier New'"> <span __designer:dtid="281474976710799" style="color: blue">route</span> [SQL/ServiceBroker/BrokerConfiguration]

<!--l                      namespace="" ns="urn:schemas-microsoft-com:office:office" prefix="o"--></span></p> <p __designer:dtid="281474976710801" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710802" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976710803"> </span><span __designer:dtid="281474976710804" style="color: blue">with</span> <span _\_designer:dtid="281474976710805" style="color: blue">service\_name</span> <span __designer:dtid="281474976710806" style="color: gray">=</span> N<span __designer:dtid="281474976710807" style="color: red">&#8216;SQL/ServiceBroker/BrokerConfiguration&#8217;</span><span __designer:dtid="281474976710808" style="color: gray">,</span></span></p> <p __designer:dtid="281474976710810" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal">&nbsp;</p> 

<span __designer:dtid="281474976710811" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976710812"> </span><span __designer:dtid="281474976710813" style="color: blue">address</span> <span __designer:dtid="281474976710814" style="color: gray">=</span> N<span __designer:dtid="281474976710815" style="color: red">&#8216;LOCAL&#8217;</span><span __designer:dtid="281474976710816" style="color: gray">;</span></span><p __designer:dtid="281474976710818">As soon as we add this route, two messages appear in the ‘dynamic routing service’ queue:</p> 

<code __designer:dtid="281474976710819"></code><p __designer:dtid="281474976710820" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710821" style="font-size: 10pt; color: blue; font-family: 'Courier New'">select</span><span __designer:dtid="281474976710822" style="font-size: 10pt; font-family: 'Courier New'"> <span __designer:dtid="281474976710823" style="color: fuchsia">cast</span><span __designer:dtid="281474976710824" style="color: gray">(</span>message_body <span __designer:dtid="281474976710825" style="color: blue">as</span> <span __designer:dtid="281474976710826" style="color: blue">xml</span><span __designer:dtid="281474976710827" style="color: gray">),</span> message\_type\_name

<!--l namespace="" ns="urn:schemas-microsoft-com:office:office"                      prefix="o"--></span></p> <p __designer:dtid="281474976710829" style="margin: 0in 0in 10pt" class="MsoNormal"><span __designer:dtid="281474976710830" style="font-size: 10pt; line-height: 115%; font-family: 'Courier New'"><span __designer:dtid="281474976710831"> </span><span __designer:dtid="281474976710832" style="color: blue">from</span> [SQL/ServiceBroker/BrokerConfiguration/Queue]</span><span __designer:dtid="281474976710833" style="font-family: 'Verdana','sans-serif'"></span></p> <p __designer:dtid="281474976710835" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710836" style="font-size: 8pt; font-family: 'Courier New'"><span __designer:dtid="281474976710837"> </span><span __designer:dtid="281474976710838"> </span>message\_type\_name</span></p> <p __designer:dtid="281474976710840" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710841" style="font-size: 8pt; font-family: 'Courier New'">&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</span></p> <p __designer:dtid="281474976710843" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span _\_designer:dtid="281474976710844" style="font-size: 8pt; font-family: 'Courier New'"><MissingRemoteServiceBinding xmlns=&#8221;http://schemas.microsoft.com/SQL/ServiceBroker/BrokerConfigurationNotice/MissingRemoteServiceBinding&#8221;><SERVICE\_NAME>MyEnterprise/Accounting</SERVICE_NAME></MissingRemoteServiceBinding><span __designer:dtid="281474976710845"> </span>http://schemas.microsoft.com/SQL/ServiceBroker/BrokerConfigurationNotice/MissingRemoteServiceBinding</span></p> <p __designer:dtid="281474976710847" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span _\_designer:dtid="281474976710848" style="font-size: 8pt; font-family: 'Courier New'"><MissingRoute xmlns=&#8221;http://schemas.microsoft.com/SQL/ServiceBroker/BrokerConfigurationNotice/MissingRoute&#8221;><SERVICE\_NAME>MyEnterprise/Accounting</SERVICE_NAME></MissingRoute><span __designer:dtid="281474976710849"> </span><span __designer:dtid="281474976710850"> </span>http://schemas.microsoft.com/SQL/ServiceBroker/BrokerConfigurationNotice/MissingRoute</span></p> <p __designer:dtid="281474976710852" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710853" style="font-size: 8pt; font-family: 'Courier New'"> </span></p> <p __designer:dtid="281474976710855" style="margin: 0in 0in 10pt" class="MsoNormal"><span __designer:dtid="281474976710856" style="font-size: 8pt; line-height: 115%; font-family: 'Courier New'">(2 row(s) affected)</span></p> <p __designer:dtid="281474976710857">We’ll ignore the message type <tt __designer:dtid="281474976710858">[http://schemas.microsoft.com/SQL/ServiceBroker/BrokerConfigurationNotice/MissingRemoteServiceBinding]</tt> for the moment, so let’s focus on the ‘MissingRoute’ one:</p> 

<code __designer:dtid="281474976710859"></code><p __designer:dtid="281474976710860" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710861" style="font-size: 10pt; color: blue; font-family: 'Courier New'"><</span><span __designer:dtid="281474976710862" style="font-size: 10pt; color: maroon; font-family: 'Courier New'">MissingRoute</span><span __designer:dtid="281474976710863" style="font-size: 10pt; color: blue; font-family: 'Courier New'"> </span><span __designer:dtid="281474976710864" style="font-size: 10pt; color: red; font-family: 'Courier New'">xmlns</span><span __designer:dtid="281474976710865" style="font-size: 10pt; color: blue; font-family: 'Courier New'">=</span><span __designer:dtid="281474976710866" style="font-size: 10pt; font-family: 'Courier New'">&#8220;<span __designer:dtid="281474976710867" style="color: blue">http://schemas.microsoft.com/SQL/ServiceBroker/BrokerConfigurationNotice/MissingRoute</span>&#8220;<span __designer:dtid="281474976710868" style="color: blue">>

<!--l namespace="" ns="urn:schemas-microsoft-com:office:office"                                          prefix="o"--></span></span></p> <p __designer:dtid="281474976710870" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710871" style="font-size: 10pt; color: blue; font-family: 'Courier New'"><span __designer:dtid="281474976710872"> </span><</span><span _\_designer:dtid="281474976710873" style="font-size: 10pt; color: maroon; font-family: 'Courier New'">SERVICE\_NAME</span><span __designer:dtid="281474976710874" style="font-size: 10pt; color: blue; font-family: 'Courier New'">></span><span __designer:dtid="281474976710875" style="font-size: 10pt; font-family: 'Courier New'">MyEnterprise/Accounting<span __designer:dtid="281474976710876" style="color: blue"></</span><span _\_designer:dtid="281474976710877" style="color: maroon">SERVICE\_NAME</span><span __designer:dtid="281474976710878" style="color: blue">></span></span></p> <p __designer:dtid="281474976710880" style="margin: 0in 0in 10pt" class="MsoNormal">&nbsp;</p> 

<span __designer:dtid="281474976710881" style="font-size: 10pt; color: blue; line-height: 115%; font-family: 'Courier New'"></</span><span __designer:dtid="281474976710882" style="font-size: 10pt; color: maroon; line-height: 115%; font-family: 'Courier New'">MissingRoute</span><span __designer:dtid="281474976710883" style="font-size: 10pt; color: blue; line-height: 115%; font-family: 'Courier New'">></span><p __designer:dtid="281474976710884">So the ‘dynamic routing service’ was requested to provide routing information about the service ‘MyEnterprise/Accounting’. The ‘dynamic routing service’ has to find the location of this service, create a route to it and end the conversation on which this request was sent. We’ll cheat for the moment and create route manually, then end the conversation manually:</p> 

<code __designer:dtid="281474976710885"></code><p __designer:dtid="281474976710886" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710887" style="font-size: 10pt; color: blue; font-family: 'Courier New'">create</span><span __designer:dtid="281474976710888" style="font-size: 10pt; font-family: 'Courier New'"> <span __designer:dtid="281474976710889" style="color: blue">route</span> [MyEnterprise/Accounting] 

<!--l namespace="" ns="urn:schemas-microsoft-com:office:office" prefix="o"--></span></p> <p __designer:dtid="281474976710891" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710892" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976710893"> </span><span __designer:dtid="281474976710894" style="color: blue">with</span> </span></p> <p __designer:dtid="281474976710896" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710897" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976710898"> </span><span _\_designer:dtid="281474976710899" style="color: blue">service\_name</span> <span __designer:dtid="281474976710900" style="color: gray">=</span> N<span __designer:dtid="281474976710901" style="color: red">&#8216;MyEnterprise/Accounting&#8217;</span><span __designer:dtid="281474976710902" style="color: gray">,</span></span></p> <p __designer:dtid="281474976710904" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710905" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976710906"> </span><span __designer:dtid="281474976710907" style="color: blue">address</span> <span __designer:dtid="281474976710908" style="color: gray">=</span> N<span __designer:dtid="281474976710909" style="color: red">&#8216;tcp://accountingserver.myenterprisedomain.org:4022&#8217;</span><span __designer:dtid="281474976710910" style="color: gray">;</span></span></p> <p __designer:dtid="281474976710912" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710913" style="font-size: 10pt; font-family: 'Courier New'">go</span></p> <p __designer:dtid="281474976710915" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710916" style="font-size: 10pt; font-family: 'Courier New'"> </span></p> <p __designer:dtid="281474976710918" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710919" style="font-size: 10pt; color: blue; font-family: 'Courier New'">begin</span><span __designer:dtid="281474976710920" style="font-size: 10pt; font-family: 'Courier New'"> <span __designer:dtid="281474976710921" style="color: blue">transaction</span></span></p> <p __designer:dtid="281474976710923" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710924" style="font-size: 10pt; color: blue; font-family: 'Courier New'">declare</span><span __designer:dtid="281474976710925" style="font-size: 10pt; font-family: 'Courier New'"> @h <span __designer:dtid="281474976710926" style="color: blue">uniqueidentifier</span><span __designer:dtid="281474976710927" style="color: gray">;</span></span></p> <p __designer:dtid="281474976710929" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710930" style="font-size: 10pt; color: blue; font-family: 'Courier New'">receive</span><span __designer:dtid="281474976710931" style="font-size: 10pt; font-family: 'Courier New'"> </span></p> <p __designer:dtid="281474976710933" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710934" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976710935"> </span>@h <span __designer:dtid="281474976710936" style="color: gray">=</span> <span _\_designer:dtid="281474976710937" style="color: blue">conversation\_handle</span></span></p> <p __designer:dtid="281474976710939" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710940" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976710941"> </span><span __designer:dtid="281474976710942" style="color: blue">from</span> [SQL/ServiceBroker/BrokerConfiguration/Queue]<span __designer:dtid="281474976710943" style="color: gray">;</span></span></p> <p __designer:dtid="281474976710945" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710946" style="font-size: 10pt; color: blue; font-family: 'Courier New'">if</span><span __designer:dtid="281474976710947" style="font-size: 10pt; font-family: 'Courier New'"> @h <span __designer:dtid="281474976710948" style="color: gray">is</span> <span __designer:dtid="281474976710949" style="color: gray">not</span> <span __designer:dtid="281474976710950" style="color: gray">null</span></span></p> <p __designer:dtid="281474976710952" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710953" style="font-size: 10pt; color: blue; font-family: 'Courier New'">begin</span></p> <p __designer:dtid="281474976710955" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710956" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976710957"> </span><span __designer:dtid="281474976710958" style="color: blue">end</span> <span __designer:dtid="281474976710959" style="color: blue">conversation</span> @h<span __designer:dtid="281474976710960" style="color: gray">;</span></span></p> <p __designer:dtid="281474976710962" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710963" style="font-size: 10pt; color: blue; font-family: 'Courier New'">end</span></p> <p __designer:dtid="281474976710965" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710966" style="font-size: 10pt; color: blue; font-family: 'Courier New'">commit</span><span __designer:dtid="281474976710967" style="font-size: 10pt; color: gray; font-family: 'Courier New'">;</span></p> <p __designer:dtid="281474976710969" style="margin: 0in 0in 10pt" class="MsoNormal">&nbsp;</p> 

<span __designer:dtid="281474976710970" style="font-size: 10pt; line-height: 115%; font-family: 'Courier New'">go</span><p __designer:dtid="281474976710971">This example shows how the ‘dynamic routing service’ functionality works and how the Service Broker routing algorithm will use this service whenever it needs to find the location of an unknown service. Of course, the difficult part is actually implementing this service correctly 🙂</p> <h2 __designer:dtid="281474976710972">Dynamic Routing Service requirements</h2> <ul __designer:dtid="281474976710973"> <li __designer:dtid="281474976710974">Has to be bound to the (<tt __designer:dtid="281474976710975">[http://schemas.microsoft.com/SQL/ServiceBroker/BrokerConfigurationNotice]</tt> contract in order to accept the MissingRoute messages</li> <li __designer:dtid="281474976710976">Has to be able to actually find the information about the location of any service in the enterprise</li> <li __designer:dtid="281474976710977">Has to create the ‘missing route’ with the information retrieved at the above step</li> <li __designer:dtid="281474976710978">Needs to end incoming request conversations</li> <li __designer:dtid="281474976710979">Has to adapt to any changes in the location of service as services are moved, retired or new services are added</li> </ul> <p __designer:dtid="281474976710980">Although the Service Broker algorithm only looks up a <em __designer:dtid="281474976710981">route</em> to the ‘dynamic routing service’ (meaning the service could be located anywhere), the requirement to create the actual ROUTE in the database means that the normal implementation of this service is in the same database where the application is. That is, <em __designer:dtid="281474976710982">every deployed database in the enterprise contains a copy of this service</em>. One can think of this service much like an automation script to provide ‘dynamic routing’. This leaves the question on how is the ‘dynamic routing service’ capable to find the location of any service? Usually this implies a central repository where all services are registered and the ‘dynamic routing service’ interrogates this central repository.</p> <p __designer:dtid="281474976710983">As for the requirement to adapt to services being moved and decommissioned, the best approach is simply to rely on a expiration time associated with each request. In fact, the ‘dynamic routing service’ doesn’t even have to implement and track this expiration time; it can simply use the <a href="http://technet.microsoft.com/en-us/library/ms186742.aspx" __designer:dtid="281474976710984"><tt __designer:dtid="281474976710985">CREATE ROUTE</tt></a> statement itself and provide a lifetime after which the route expires:</p> 

<code __designer:dtid="281474976710986"></code><p __designer:dtid="281474976710987" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710988" style="font-size: 10pt; color: blue; font-family: 'Courier New'">create</span><span __designer:dtid="281474976710989" style="font-size: 10pt; font-family: 'Courier New'"> <span __designer:dtid="281474976710990" style="color: blue">route</span> [MyEnterprise/Accounting] 

<!--l namespace="" ns="urn:schemas-microsoft-com:office:office" prefix="o"--></span></p> <p __designer:dtid="281474976710992" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710993" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976710994"> </span><span __designer:dtid="281474976710995" style="color: blue">with</span> </span></p> <p __designer:dtid="281474976710997" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976710998" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976710999"> </span><span _\_designer:dtid="281474976711000" style="color: blue">service\_name</span> <span __designer:dtid="281474976711001" style="color: gray">=</span> N<span __designer:dtid="281474976711002" style="color: red">&#8216;MyEnterprise/Accounting&#8217;</span><span __designer:dtid="281474976711003" style="color: gray">,</span></span></p> <p __designer:dtid="281474976711005" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711006" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976711007"> </span><span __designer:dtid="281474976711008" style="color: blue">address</span> <span __designer:dtid="281474976711009" style="color: gray">=</span> N<span __designer:dtid="281474976711010" style="color: red">&#8216;tcp://accountingserver.myenterprisedomain.org:4022&#8217;</span><span __designer:dtid="281474976711011" style="color: gray">,</span></span></p> <p __designer:dtid="281474976711013" style="margin: 0in 0in 10pt" class="MsoNormal">&nbsp;</p> 

<span __designer:dtid="281474976711014" style="font-size: 10pt; line-height: 115%; font-family: 'Courier New'"><span __designer:dtid="281474976711015"> </span><strong __designer:dtid="281474976711016">LIFETIME <span __designer:dtid="281474976711017" style="color: gray">=</span> 3600<span __designer:dtid="281474976711018" style="color: gray">;</span></strong></span><p __designer:dtid="281474976711019">When the newly created route expires, a new request will be sent to the ‘dynamic routing service’. The actual expiration lifetime value is dependent on how fast is desired that the system reacts to a service being relocated and how often are such relocation expected to occur. Reasonable lifetimes are in the range of 5-10 minutes up to hours. Days would probably be too long and cause long times of unavailability if an unexpired route keeps sending messages to a service at the old location, sorter times will result in too many lookups on the central repository and cause unnecessary contention.</p> <h2 __designer:dtid="281474976711020">The Central Repository</h2> <p __designer:dtid="281474976711021">So how is the ‘dynamic routing service’ supposed to interrogate the central repository about the location of the ‘unknown’ services? Here are some alternatives:</p> <ul __designer:dtid="281474976711022"> <li __designer:dtid="281474976711023">Use Service Broker. Although it seems like a chicken and egg problem, it is not J If Service Broker is used to interrogate the central repository, then the necessary routes to reach the ‘central repository have to be pre-deployed with each database, because otherwise the ‘dynamic routing service’ will not be able to find the location … of the central repository service.</li> <li __designer:dtid="281474976711024">Use Active Directory. The ‘dynamic routing service’ could use an ADSI linked server to query the Active Directory using LDAP. Of course, this means that your Active Directory environment has to contain new schema objects for Service Broker services. The Windows 2003 Active Directory schema contains objects like ‘SQL Server Instance’ and ‘SQL Server Database’, but it does not contain ‘SQL Server Service Broker Service’. Another approach is to use the Active Directory ‘Service-Connection-Point’ objects and provide the service address as the ‘Service-Binding-Information’ property.</li> <li __designer:dtid="281474976711025">Use a file share, simply lookup a well known share where a each known service contains a describing its location (perhaps a ‘service listing’ created with the Service Listing Manager tool)</li> <li __designer:dtid="281474976711026">Use a Web Service</li> </ul> <p __designer:dtid="281474976711027">If I would do such a Central Repository, of course, I would choose option 1 :). The Active Directory option is also interesting, but I have to recon that I could not implement it when I tried. But my knowledge and understanding of AD is quite minimal, and I had to deal with an environment where I was restricted severely in what I could do/modify in the AD (the actual Redmond MS domain). If you implement this successfully, drop me a note about it, I’m actually interested how it’s done.</p> <p __designer:dtid="281474976711028">Another subject of interest is how to keep this Central Repository up to date. One could use Event Notifications for this! Even more, the ‘dynamic routing service’ itself can be extended to accept the [http://schemas.microsoft.com/SQL/Notifications/PostEventNotification] contract and subscribe to the <tt __designer:dtid="281474976711029">CREATE/ALTER/DROP SERVICE</tt> events:</p> 

<code __designer:dtid="281474976711030"></code><p __designer:dtid="281474976711031" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711032" style="font-size: 10pt; color: blue; font-family: 'Courier New'">create</span><span __designer:dtid="281474976711033" style="font-size: 10pt; font-family: 'Courier New'"> <span __designer:dtid="281474976711034" style="color: blue">event</span> <span __designer:dtid="281474976711035" style="color: blue">notification</span> [SQL/ServiceBroker/BrokerConfiguration/Services]

<!--l namespace="" ns="urn:schemas-microsoft-com:office:office"                      prefix="o"--></span></p> <p __designer:dtid="281474976711037" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711038" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976711039"> </span><span __designer:dtid="281474976711040" style="color: blue">on</span> <span __designer:dtid="281474976711041" style="color: blue">database</span></span></p> <p __designer:dtid="281474976711043" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711044" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976711045"> </span><span __designer:dtid="281474976711046" style="color: blue">for</span> create_service<span __designer:dtid="281474976711047" style="color: gray">,</span> alter_service<span __designer:dtid="281474976711048" style="color: gray">,</span> drop_service</span></p> <p __designer:dtid="281474976711050" style="margin: 0in 0in 10pt" class="MsoNormal">&nbsp;</p> 

<span __designer:dtid="281474976711051" style="font-size: 10pt; line-height: 115%; font-family: 'Courier New'"><span __designer:dtid="281474976711052"> </span><span __designer:dtid="281474976711053" style="color: blue">to</span> <span __designer:dtid="281474976711054" style="color: blue">service</span> N<span __designer:dtid="281474976711055" style="color: red">&#8216;SQL/ServiceBroker/BrokerConfiguration&#8217;</span><span __designer:dtid="281474976711056" style="color: gray">,</span> <span __designer:dtid="281474976711057" style="color: red">&#8216;current database&#8217;</span><span __designer:dtid="281474976711058" style="color: gray">;</span></span><p __designer:dtid="281474976711060">This event notification subscription will send a message to our service each time a service is created, altered or dropped in the database. Since the ‘dynamic routing service’ has the means to communicate with the Central Repository in the first place, it can use these means to add, modify and drop service information in the repository. The service would also have to deal with services being moved around, either by databases that are detached/attached to a different instance, or by SQL Server host machines being renamed, but I will not drill further into this topic.</p> <h2 __designer:dtid="281474976711061">Gotcha!</h2> <p __designer:dtid="281474976711062">Whenever a route to the ‘dynamic routing service’ is added, a pretty unexpected thing happens: all of the services in the database become all of the sudden unreachable! This is because, according to the routing algorithm described at http://technet.microsoft.com/en-us/library/ms166052.aspx they are usually reached via the default ‘AutoCreatedLocal’ route at step 5 in the algorithm:</p> <p __designer:dtid="281474976711063">5. Find a route that does not specify either the service name or the service broker identifier</p> <p __designer:dtid="281474976711064">But when a ‘dynamic routing service’ is added, the step 4 takes precedence and thus all local services are suddenly ‘delayed’ expecting an answer from the ‘dynamic routing service’! To prevent this from happening, whenever one adds the route to the ‘dynamic routing service’ it should also add an explicit ‘LOCAL’ route to the built-in services:</p> 

<code __designer:dtid="281474976711065"></code><p __designer:dtid="281474976711066" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711067" style="font-size: 10pt; color: green; font-family: 'Courier New'">&#8212; Because we enabled dynamic routing, all of the existing 

<!--l namespace="" ns="urn:schemas-microsoft-com:office:office" prefix="o"--></span></p> <p __designer:dtid="281474976711069" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711070" style="font-size: 10pt; color: green; font-family: 'Courier New'">&#8212; services in the database are sudenly unreacheable, unless an</span></p> <p __designer:dtid="281474976711072" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711073" style="font-size: 10pt; color: green; font-family: 'Courier New'">&#8212; explicit route is created for them. this includes the built-in services</span></p> <p __designer:dtid="281474976711075" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711076" style="font-size: 10pt; color: green; font-family: 'Courier New'">&#8212; like Event Notifications and Query Notifications, as well as the </span></p> <p __designer:dtid="281474976711078" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711079" style="font-size: 10pt; color: green; font-family: 'Courier New'">&#8212; &#8216;ServiceBroker&#8217; service itself.</span></p> <p __designer:dtid="281474976711081" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711082" style="font-size: 10pt; color: green; font-family: 'Courier New'">&#8212;</span></p> <p __designer:dtid="281474976711084" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711085" style="font-size: 10pt; color: blue; font-family: 'Courier New'">create</span><span __designer:dtid="281474976711086" style="font-size: 10pt; font-family: 'Courier New'"> <span __designer:dtid="281474976711087" style="color: blue">route</span> [http://schemas.microsoft.com/SQL/Notifications/EventNotificationService]</span></p> <p __designer:dtid="281474976711089" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711090" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976711091"> </span><span __designer:dtid="281474976711092" style="color: blue">with</span> <span _\_designer:dtid="281474976711093" style="color: blue">service\_name</span> <span __designer:dtid="281474976711094" style="color: gray">=</span> N<span __designer:dtid="281474976711095" style="color: red">&#8216;http://schemas.microsoft.com/SQL/Notifications/EventNotificationService&#8217;</span><span __designer:dtid="281474976711096" style="color: gray">,</span></span></p> <p __designer:dtid="281474976711098" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711099" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976711100"> </span><span __designer:dtid="281474976711101" style="color: blue">address</span> <span __designer:dtid="281474976711102" style="color: gray">=</span> N<span __designer:dtid="281474976711103" style="color: red">&#8216;LOCAL&#8217;</span><span __designer:dtid="281474976711104" style="color: gray">;</span></span></p> <p __designer:dtid="281474976711106" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711107" style="font-size: 10pt; color: gray; font-family: 'Courier New'"> </span></p> <p __designer:dtid="281474976711109" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711110" style="font-size: 10pt; color: blue; font-family: 'Courier New'">create</span><span __designer:dtid="281474976711111" style="font-size: 10pt; font-family: 'Courier New'"> <span __designer:dtid="281474976711112" style="color: blue">route</span> [http://schemas.microsoft.com/SQL/Notifications/QueryNotificationService]</span></p> <p __designer:dtid="281474976711114" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711115" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976711116"> </span><span __designer:dtid="281474976711117" style="color: blue">with</span> <span _\_designer:dtid="281474976711118" style="color: blue">service\_name</span> <span __designer:dtid="281474976711119" style="color: gray">=</span> N<span __designer:dtid="281474976711120" style="color: red">&#8216;http://schemas.microsoft.com/SQL/Notifications/QueryNotificationService&#8217;</span><span __designer:dtid="281474976711121" style="color: gray">,</span></span></p> <p __designer:dtid="281474976711123" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711124" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976711125"> </span><span __designer:dtid="281474976711126" style="color: blue">address</span> <span __designer:dtid="281474976711127" style="color: gray">=</span> N<span __designer:dtid="281474976711128" style="color: red">&#8216;LOCAL&#8217;</span><span __designer:dtid="281474976711129" style="color: gray">;</span></span></p> <p __designer:dtid="281474976711131" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711132" style="font-size: 10pt; color: gray; font-family: 'Courier New'"> </span></p> <p __designer:dtid="281474976711134" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711135" style="font-size: 10pt; color: blue; font-family: 'Courier New'">create</span><span __designer:dtid="281474976711136" style="font-size: 10pt; font-family: 'Courier New'"> <span __designer:dtid="281474976711137" style="color: blue">route</span> [http://schemas.microsoft.com/SQL/ServiceBroker/ServiceBroker]</span></p> <p __designer:dtid="281474976711139" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711140" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976711141"> </span><span __designer:dtid="281474976711142" style="color: blue">with</span> <span _\_designer:dtid="281474976711143" style="color: blue">service\_name</span> <span __designer:dtid="281474976711144" style="color: gray">=</span> N<span __designer:dtid="281474976711145" style="color: red">&#8216;http://schemas.microsoft.com/SQL/ServiceBroker/ServiceBroker&#8217;</span><span __designer:dtid="281474976711146" style="color: gray">,</span></span></p> <p __designer:dtid="281474976711148" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711149" style="font-size: 10pt; font-family: 'Courier New'"><span __designer:dtid="281474976711150"> </span><span __designer:dtid="281474976711151" style="color: blue">address</span> <span __designer:dtid="281474976711152" style="color: gray">=</span> N<span __designer:dtid="281474976711153" style="color: red">&#8216;LOCAL&#8217;</span><span __designer:dtid="281474976711154" style="color: gray">;</span></span></p> <p __designer:dtid="281474976711156" style="margin: 0in 0in 0pt; line-height: normal" class="MsoNormal"><span __designer:dtid="281474976711157" style="font-size: 10pt; font-family: 'Courier New'">go</span></p>